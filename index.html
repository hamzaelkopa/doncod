<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>doncod - Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #87ceeb; }
        canvas { display: block; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .interactive { pointer-events: auto; }
        .glass { background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        @keyframes drift {
            0% { transform: translateX(0); }
            50% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }
        .speed-gauge { animation: drift 2s infinite ease-in-out; }
    </style>
</head>
<body>

    <!-- UI Layer -->
    <div id="ui-layer" class="flex flex-col justify-between p-6 text-slate-800">
        <div class="flex justify-between items-start">
            <div class="glass p-4 rounded-2xl">
                <h1 class="text-3xl font-bold tracking-tighter text-blue-900">doncod</h1>
                <p class="text-xs font-semibold opacity-80">ØªÙ… ØªØ·ÙˆÙŠØ±Ù‡Ø§ Ù…Ù† Ù‚Ø¨Ù„ Ø­Ù…Ø²Ø© Ø§Ù„Ù‚Ø¨Ø©</p>
            </div>
            
            <div id="msg-box" class="glass px-8 py-3 rounded-full opacity-0 transition-all duration-500 font-bold text-blue-900 shadow-xl transform -translate-y-4">
                Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
            </div>

            <div class="glass p-4 rounded-2xl text-right">
                <div class="text-sm font-bold opacity-80">Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</div>
                <div id="money-display" class="text-2xl font-mono text-yellow-600 font-black">$0</div>
            </div>
        </div>

        <div class="flex justify-between items-end">
            <div class="glass p-6 rounded-full w-40 h-40 flex flex-col items-center justify-center speed-gauge border-4 border-white">
                <div id="speed-val" class="text-4xl font-black text-blue-900">0</div>
                <div class="text-xs uppercase font-bold">ÙƒÙ…/Ø³</div>
            </div>

            <div class="flex gap-4 interactive">
                <button onclick="toggleGarage()" class="glass p-4 rounded-xl hover:bg-white/40 transition font-bold text-blue-900 shadow-lg">
                    ğŸš— Ø§Ù„ÙƒØ±Ø§Ø¬ ÙˆØ§Ù„Ù…ØªØ¬Ø±
                </button>
                <div class="flex flex-col gap-2">
                    <div class="text-xs text-center font-bold">ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ†</div>
                    <input type="color" id="colorPicker" value="#ff0000" onchange="changeCarColor(this.value)" class="w-12 h-12 rounded-lg cursor-pointer bg-transparent border-none">
                </div>
            </div>
        </div>
    </div>

    <!-- Garage Modal -->
    <div id="garage-modal" class="fixed inset-0 bg-white/40 hidden items-center justify-center z-50 p-4 backdrop-blur-md">
        <div class="glass max-w-2xl w-full p-8 rounded-3xl text-blue-900 shadow-2xl">
            <div class="flex justify-between mb-6">
                <h2 class="text-2xl font-black italic underline decoration-yellow-500">Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</h2>
                <button onclick="toggleGarage()" class="text-3xl font-bold">&times;</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="car-list">
                <div class="bg-white/40 p-4 rounded-xl flex justify-between items-center border border-white">
                    <div>
                        <h3 class="font-bold">Sport Phantom</h3>
                        <p class="text-sm opacity-70">Ø³Ø±Ø¹Ø© ÙØ§Ø¦Ù‚Ø©</p>
                    </div>
                    <button onclick="buyCar(500, 'sport')" class="bg-yellow-500 px-4 py-2 rounded-lg font-black text-white hover:bg-yellow-400 transition shadow-md border-b-4 border-yellow-700">$500</button>
                </div>
                <div class="bg-white/40 p-4 rounded-xl flex justify-between items-center border border-white">
                    <div>
                        <h3 class="font-bold">GT Master</h3>
                        <p class="text-sm opacity-70">Ø«Ø¨Ø§Øª ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ©</p>
                    </div>
                    <button onclick="buyCar(1200, 'gt')" class="bg-yellow-500 px-4 py-2 rounded-lg font-black text-white hover:bg-yellow-400 transition shadow-md border-b-4 border-yellow-700">$1200</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let scene, camera, renderer, car, road, sun, skyLight;
        let speed = 0;
        let money = 0;
        let carColor = 0xff0000;
        let keys = {};
        let coins = [];
        let buildings = [];
        let trafficCars = [];
        const MAX_SPEED = 2.8;
        const ACCELERATION = 0.012;
        const FRICTION = 0.005;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xaedefc); 
            scene.fog = new THREE.Fog(0xaedefc, 50, 300);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 4, 11);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.toneMapping = THREE.NoToneMapping; // ØªØºÙŠÙŠØ± Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            document.body.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.9);
            scene.add(ambientLight);

            sun = new THREE.DirectionalLight(0xffffff, 1.0);
            sun.position.set(10, 50, 20);
            sun.castShadow = true;
            scene.add(sun);

            createRoad();
            createProfessionalCar();
            spawnCoins();
            createCity();
            spawnTraffic();

            window.addEventListener('keydown', e => keys[e.code] = true);
            window.addEventListener('keyup', e => keys[e.code] = false);
            window.addEventListener('resize', onWindowResize);

            animate();
        }

        function createRoad() {
            const roadGeometry = new THREE.PlaneGeometry(26, 10000);
            const roadMaterial = new THREE.MeshStandardMaterial({ color: 0x333333, roughness: 0.8 });
            road = new THREE.Mesh(roadGeometry, roadMaterial);
            road.rotation.x = -Math.PI / 2;
            road.receiveShadow = true;
            scene.add(road);

            const sidewalkGeo = new THREE.BoxGeometry(2, 0.6, 10000);
            const sidewalkMat = new THREE.MeshStandardMaterial({ color: 0xcccccc });
            const leftSidewalk = new THREE.Mesh(sidewalkGeo, sidewalkMat);
            leftSidewalk.position.set(-14, 0.3, 0);
            scene.add(leftSidewalk);
            const rightSidewalk = new THREE.Mesh(sidewalkGeo, sidewalkMat);
            rightSidewalk.position.set(14, 0.3, 0);
            scene.add(rightSidewalk);

            for(let i = 0; i < 400; i++) {
                const stripe = new THREE.Mesh(new THREE.PlaneGeometry(0.5, 7), new THREE.MeshBasicMaterial({ color: 0xffffff }));
                stripe.rotation.x = -Math.PI / 2;
                stripe.position.set(0, 0.04, -i * 25);
                scene.add(stripe);
            }
        }

        function createCity() {
            const buildGeo = new THREE.BoxGeometry(1, 1, 1);
            for(let i = 0; i < 120; i++) {
                const side = i % 2 === 0 ? 1 : -1;
                const h = 15 + Math.random() * 50;
                const w = 10 + Math.random() * 8;
                const d = 10 + Math.random() * 8;
                const bMat = new THREE.MeshStandardMaterial({ 
                    color: new THREE.Color().setHSL(Math.random() * 0.1 + 0.5, 0.3, 0.7),
                    roughness: 0.5
                });
                const building = new THREE.Mesh(buildGeo, bMat);
                building.scale.set(w, h, d);
                building.position.set(side * (25 + Math.random() * 15), h/2, -i * 60);
                building.receiveShadow = true;
                scene.add(building);
                buildings.push(building);
            }
        }

        function createProfessionalCar() {
            const carGroup = new THREE.Group();
            
            // ØªØ¹Ø¯ÙŠÙ„ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù…Ø§Ø¯Ø© Ù„ØªÙƒÙˆÙ† Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙØ§ØªØ­Ø© ÙˆØ¯Ù‚ÙŠÙ‚Ø©
            const bodyMat = new THREE.MeshPhongMaterial({ 
                color: carColor, 
                shininess: 100,
                specular: 0x222222 
            });

            const body = new THREE.Mesh(
                new THREE.BoxGeometry(2.3, 0.6, 4.6),
                bodyMat
            );
            body.position.y = 0.65;
            body.castShadow = true;
            carGroup.add(body);

            const cabin = new THREE.Mesh(
                new THREE.BoxGeometry(1.8, 0.75, 2.3),
                new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.1 })
            );
            cabin.position.set(0, 1.25, 0.2);
            carGroup.add(cabin);

            const spoiler = new THREE.Mesh(new THREE.BoxGeometry(2.3, 0.1, 0.7), new THREE.MeshStandardMaterial({ color: 0x000000 }));
            spoiler.position.set(0, 1.45, 2);
            carGroup.add(spoiler);

            const wheelGeo = new THREE.CylinderGeometry(0.5, 0.5, 0.55, 32);
            const wheelMat = new THREE.MeshStandardMaterial({ color: 0x111111 });
            [[-1.15, 0.5, 1.6], [1.15, 0.5, 1.6], [-1.15, 0.5, -1.6], [1.15, 0.5, -1.6]].forEach(p => {
                const w = new THREE.Mesh(wheelGeo, wheelMat);
                w.rotation.z = Math.PI/2;
                w.position.set(...p);
                w.castShadow = true;
                carGroup.add(w);
            });

            car = carGroup;
            scene.add(car);
        }

        function spawnTraffic() {
            for(let i = 0; i < 20; i++) {
                const tCar = new THREE.Group();
                const tBody = new THREE.Mesh(
                    new THREE.BoxGeometry(2.1, 0.9, 4.2),
                    new THREE.MeshStandardMaterial({ color: new THREE.Color().setHSL(Math.random(), 0.5, 0.5) })
                );
                tBody.position.y = 0.7;
                tCar.add(tBody);
                tCar.position.set((Math.random()-0.5)*20, 0, -200 - (i * 120));
                scene.add(tCar);
                trafficCars.push({ mesh: tCar, speed: 0.7 + Math.random() * 0.6 });
            }
        }

        function spawnCoins() {
            const coinGeo = new THREE.TorusGeometry(0.5, 0.15, 16, 100);
            const coinMat = new THREE.MeshStandardMaterial({ 
                color: 0xffd700, 
                metalness: 0.5, 
                roughness: 0.2,
                emissive: 0xffa500,
                emissiveIntensity: 0.4
            });
            for(let i = 0; i < 45; i++) {
                const coin = new THREE.Mesh(coinGeo, coinMat);
                coin.rotation.y = Math.PI / 2;
                coin.position.set((Math.random() - 0.5) * 20, 1.2, -150 - (i * 50));
                scene.add(coin);
                coins.push(coin);
            }
        }

        function checkCollisions() {
            coins.forEach(coin => {
                if (coin.visible && car.position.distanceTo(coin.position) < 2.8) {
                    coin.visible = false;
                    money += 150;
                    updateUI();
                    showMessage("+$150 Ø°Ù‡Ø¨ Ø­Ù‚ÙŠÙ‚ÙŠ!");
                }
                if (coin.position.z > car.position.z + 20) {
                    coin.position.z -= 2250;
                    coin.visible = true;
                }
                coin.rotation.y += 0.1;
                coin.position.y = 1.2 + Math.sin(Date.now() * 0.005) * 0.2;
            });

            trafficCars.forEach(t => {
                t.mesh.position.z -= t.speed;
                if (t.mesh.position.z > car.position.z + 60) {
                    t.mesh.position.z -= 2400;
                    t.mesh.position.x = (Math.random()-0.5)*20;
                }
                if (car.position.distanceTo(t.mesh.position) < 3.2) {
                    speed *= 0.4;
                    showMessage("Ø­Ø§Ø¯Ø«! Ø§Ù†ØªØ¨Ù‡ ÙŠØ§ Ø­Ù…Ø²Ø©");
                    t.mesh.position.z -= 15;
                }
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            if (keys['ArrowUp'] || keys['KeyW']) speed = Math.min(speed + ACCELERATION, MAX_SPEED);
            else speed = Math.max(speed - FRICTION, 0);

            if (keys['ArrowLeft'] || keys['KeyA']) {
                car.position.x = Math.max(car.position.x - 0.18, -11);
                car.rotation.z = 0.05;
            } else if (keys['ArrowRight'] || keys['KeyD']) {
                car.position.x = Math.min(car.position.x + 0.18, 11);
                car.rotation.z = -0.05;
            } else car.rotation.z = 0;

            car.position.z -= speed;
            camera.position.z = car.position.z + 12;
            camera.position.x = car.position.x * 0.4;
            camera.position.y = 4 + speed;
            camera.lookAt(car.position.x, 1, car.position.z - 20);

            checkCollisions();
            renderer.render(scene, camera);
        }

        function changeCarColor(c) { 
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆÙ† Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø± ÙˆÙØ§ØªØ­
            car.children[0].material.color.set(c); 
            showMessage("ØªÙ… ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø³ÙŠØ§Ø±Ø©!"); 
        }

        function toggleGarage() { const m = document.getElementById('garage-modal'); m.classList.toggle('hidden'); m.classList.toggle('flex'); }
        function updateUI() { 
            document.getElementById('money-display').innerText = `$${Math.floor(money)}`; 
            document.getElementById('speed-val').innerText = Math.floor(speed * 110); 
        }
        
        function showMessage(t) { 
            const b = document.getElementById('msg-box'); 
            b.innerText = t; 
            b.style.opacity = "1"; 
            b.style.transform = "translateY(0)"; 
            setTimeout(() => {
                b.style.opacity = "0";
                b.style.transform = "translateY(-1rem)"; 
            }, 2500); 
        }
        
        function onWindowResize() { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); }

        window.onload = init;
    </script>
</body>
</html>
